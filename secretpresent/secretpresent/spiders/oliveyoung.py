import scrapy
import json
import time

from secretpresent.models.marketplace import Marketplace


class KakaoSpider(scrapy.Spider):
    name = "oliveyoung"
    allowed_domains = ["www.oliveyoung.co.kr/store"]
    main_categories = {'10000010001': '스킨케어', '10000010009': '마스크팩', '10000010010': '클렌징', '10000010011': '선케어',
                       '10000010002': '메이크업', '10000010012': '네일', '10000010006': '미용소품', '10000010008': '더모 코스메틱',
                       '10000010007': '맨즈케어', '10000010005': '향수', '10000010004': '헤어케어', '10000010003': '바디케어',
                       '10000020001': '건강식품', '10000020002': '푸드', '10000020003': '구강용품', '10000020005': '헬스/건강용품',
                       '10000020004': '여성/위생용품', '10000030007': '컴포트웨어', '10000030005': '리빙/펫', '10000030006': '취미/팬시'}

    sub_categories = {'100000100010013': '스킨/토너', '100000100010014': '에센스/세럼/앰플', '100000100010015': '크림',
                      '100000100010016': '로션', '100000100010010': '미스트/오일', '100000100010017': '스킨케어세트',
                      '100000100090001': '시트팩', '100000100090004': '패드', '100000100090002': '페이셜팩',
                      '100000100090005': '코팩', '100000100090006': '패치', '100000100100001': '클렌징폼/젤',
                      '100000100100004': '오일/밤', '100000100100005': '워터/티슈/밀크', '100000100100007': '필링/스크럽',
                      '100000100100006': '립&아이리무버', '100000100110001': '선블록', '100000100110002': '태닝/애프터선',
                      '100000100020006': '립메이크업', '100000100020001': '베이스메이크업', '100000100020007': '아이메이크업',
                      '100000100120007': '폴리시', '100000100120009': '네일팁', '100000100120008': '스티커',
                      '100000100120004': '네일케어', '100000100060001': '메이크업소품', '100000100060006': '스킨케어소품',
                      '100000100060007': '아이소품', '100000100060002': '헤어/바디소품', '100000100060004': '미용가전',
                      '100000100060003': '미용관리', '100000100060005': '미용잡화', '100000100080013': '스킨케어',
                      '100000100080004': '바디케어', '100000100080006': '클렌징', '100000100080005': '선케어',
                      '100000100080011': '마스크팩', '100000100070007': '스킨케어', '100000100070008': '메이크업',
                      '100000100070010': '쉐이빙', '100000100070009': '헤어케어', '100000100070011': '바디케어',
                      '100000100070017': '프래그런스/라이프', '100000100050003': '여성향수', '100000100050004': '남성향수',
                      '100000100050011': '유니섹스향수', '100000100050010': '고체향수', '100000100040008': '샴푸/린스',
                      '100000100040007': '트리트먼트/팩', '100000100040013': '헤어에센스', '100000100040010': '염색약/펌',
                      '100000100040004': '헤어기기/브러시', '100000100040011': '스타일링', '100000100030014': '로션/오일',
                      '100000100030005': '샤워/입욕', '100000100030008': '립케어', '100000100030016': '핸드케어',
                      '100000100030019': '제모/왁싱', '100000100030015': '바디미스트', '100000100030012': '데오드란트',
                      '100000100030017': '선물세트', '100000100030020': '맘&베이비', '100000200010015': '비타민',
                      '100000200010024': '유산균', '100000200010025': '영양제', '100000200010023': '슬리밍/이너뷰티',
                      '100000200010026': '키즈', '100000200020020': '이너뷰티/식단관리', '100000200020022': '생수/음료/커피',
                      '100000200020023': '과자/간식', '100000200020024': '간편식/요리', '100000200020021': '베이비푸드',
                      '100000200030015': '칫솔', '100000200030016': '치약', '100000200030017': '애프터구강케어',
                      '100000200030018': '휴대용세트', '100000200030019': '구강가전', '100000200050001': '패치/겔',
                      '100000200050002': '눈 관리 용품', '100000200050003': '생활/의료', '100000200050004': '마사지/헬스용품',
                      '100000200050005': '풋케어', '100000200040001': '생리용품', '100000200040006': 'Y존케어',
                      '100000200040003': '성인용품', '100000200040008': '테스트기', '100000200040007': '성인용 기저귀',
                      '100000300070001': '우먼웨어', '100000300070002': '맨즈웨어', '100000300070003': '홈웨어',
                      '100000300070004': '양말/스타킹', '100000300050011': '홈프래그런스', '100000300050012': '가전',
                      '100000300050013': '생활/주방', '100000300050014': '인테리어', '100000300050015': '베이비',
                      '100000300050016': '제지류', '100000300050017': '반려동물', '100000300060001': '디자인문구',
                      '100000300060002': '취미용품', '100000300060003': '액세서리', '100000300060004': '디지털/사무'}

    def start_requests(self):
        base_url = "https://gift.kakao.com/a/v2/search/products"
        current_timestamp = int(time.time())
        urls = [f'{base_url}?query=전구&page={x}&_={current_timestamp}' for x in range(1, 6)]
        for url in urls:
            print("------------------------" + url + "---------------------------")
            yield scrapy.Request(url=url, callback=self.parse)

    def parse(self, response):
        products = json.loads(response.text)["products"]
        for product in products['contents']:
            product['_id'] = product['id']
            product['marketplace'] = Marketplace.KAKAO
            yield product
